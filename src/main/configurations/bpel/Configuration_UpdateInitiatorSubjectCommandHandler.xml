<Module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../FrankConfig.xsd">
    <Adapter
        name="UpdateInitiatorSubjectCommandHandler"
        active="${UpdateInitiatorSubjectCommandHandler.Active}"
        description=""
        >
        <!-- 
            message: UwGegevens domdoc
            sesionKey: CaseReferenceNumber string
        -->
        <Receiver
            name="UpdateInitiatorSubjectCommandHandler"
            transactionAttribute="RequiresNew"
            pollInterval="1"
            maxRetries="1"
            >
            <MessageStoreListener
                name="UpdateInitiatorSubjectCommandHandler"
				slotId="${instance.name}/UpdateInitiatorSubjectCommand"
                sessionKeys="CaseReferenceNumber"
				/>
        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="EXIT" state="SUCCESS" />
                <Exit name="EXCEPTION" state="ERROR" />
            </Exits>

            <XsltPipe
                name="CreateLookUpCaseIdsRequestMessage"
                getInputFromFixedValue="&lt;dummy/&gt;"
                styleSheetName="Bpel/Cases/Model/LookUpCaseIdsRequestMessage.xslt"
                storeResultInSessionKey="LookUpCaseIdsRequestMessage"
                >
                <Param name="ReferenceNumber" sessionKey="CaseReferenceNumber" />
                <Forward name="success" path="BpelCasesPostLookUpCaseIdsSender" />
            </XsltPipe>

            <SenderPipe
                name="BpelCasesPostLookUpCaseIdsSender"
                storeResultInSessionKey="LookUpCaseIdsResponseMessage"
                >
                <IbisLocalSender
                    name="BpelCasesPostLookUpCaseIdsLocalSender"
                    javaListener="Bpel_Cases_Post"
                    >
                </IbisLocalSender>
                <Param name="soapAction" value="cases:lookUpCaseIds" />
                <Forward name="success" path="CreateReadCasesRequestMessage" />
            </SenderPipe>

            <XsltPipe
                name="CreateReadCasesRequestMessage"
                getInputFromFixedValue="&lt;dummy/&gt;"
                styleSheetName="Bpel/Cases/Model/ReadCasesRequestMessage.xslt"
                storeResultInSessionKey="ReadCasesRequestMessage"
                >
                <Param name="Id" sessionKey="LookUpCaseIdsResponseMessage" xpathExpression="//*:cases/*:case/*:id" />
                <Forward name="success" path="BpelCasesPostReadCasesSender" />
            </XsltPipe>

            <SenderPipe
                name="BpelCasesPostReadCasesSender"
                storeResultInSessionKey="ReadCasesResponseMessage"
                >
                <IbisLocalSender
                    name="BpelCasesPostReadCasesLocalSender"
                    javaListener="Bpel_Cases_Post"
                    >
                </IbisLocalSender>
                <Param name="soapAction" value="cases:readCases" />
                <Forward name="success" path="CreateUpdateDetailedCaseMessage" />
            </SenderPipe>

            <XsltPipe
                name="CreateUpdateDetailedCaseMessage"
                getInputFromSessionKey="ReadCasesResponseMessage"
                styleSheetName="Bpel/Cases/Model/UpdateDetailedCaseRequestMessage.xslt"
                storeResultInSessionKey="UpdateDetailedCaseRequestMessage"
                >
                <Param name="EmailAddress" sessionKey="originalMessage" xpathExpression="//*[starts-with(name(), 'contactgegevens')]/*[starts-with(name(), 'eMailadres')]" />
                <Param name="TelephoneNumber" sessionKey="originalMessage" xpathExpression="//*[starts-with(name(), 'contactgegevens')]/*[starts-with(name(), 'telefoonnummer')]" />
                <Forward name="success" path="BpelCasesPostUpdateDetailedCaseSender" />
            </XsltPipe>

            <SenderPipe
                name="BpelCasesPostUpdateDetailedCaseSender"
                storeResultInSessionKey="UpdateDetailedCaseResponseMessage"
                >
                <IbisLocalSender
                    name="BpelCasesPostUpdateDetailedCaseLocalSender"
                    javaListener="Bpel_Cases_Post"
                    >
                </IbisLocalSender>
                <Param name="soapAction" value="cases:updateDetailedCase" />
                <Forward name="success" path="InitiatorSubjectUpdatedEventSender" />
            </SenderPipe>

            <SenderPipe
				name="InitiatorSubjectUpdatedEventSender"
                getInputFromSessionKey="CaseReferenceNumber"
                transactionAttribute="NotSupported"
				>
				<MessageStoreSender
					name="InitiatorSubjectUpdatedEventMessageStoreSender"
					slotId="${instance.name}/InitiatorSubjectUpdatedEventEvent"
                    onlyStoreWhenMessageIdUnique="true"
					>
				</MessageStoreSender>
                <Forward name="success" path="EXIT" />
			</SenderPipe>
        </Pipeline>
    </Adapter>
</Module>