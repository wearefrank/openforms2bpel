<Module>
    <Adapter name="Register"
             description="">

        <Receiver name="Register">
            <JavaListener name="StartRegisterProcess"/>
        </Receiver>

        <Pipeline>

            <EsbSoapInputWrapper cmhVersion="2"
                                 direction="unwrap"
                                 removeOutputNamespaces="true"
                                 storeResultInSessionKey="originalMessage" />


<!--            Xslt -->

            <EsbSoapOutputWrapper cmhVersion="2">
                <param name="errorCode" sessionKey="errorCode"/>
                <param name="errorReason" sessionKey="errorReason"/>
                <Param name="destination" value=""/>
            </EsbSoapOutputWrapper>

            <EsbJmsSender name="SendRegisterProcess" >
                <Param name="soapAction" value=""/>

                <EsbSoapInputValidator
                        schemaLocation="xsd/Register.xsd"
                        soapBody="RegisterRequestMessage"
                        soapVersion="auto"
                        ignoreUnknownNamespaces="true"
                        cmhVersion="2">
                    <Forward name="failure" path="EXIT"/>
                    <Forward name="parserError" path="EXIT"/>
                </EsbSoapInputValidator>

                <EsbSoapOutputValidator
                        schemaLocation="xsd/Register.xsd"
                        soapBody="RegisterResponseMessage"
                        soapVersion="auto"
                        ignoreUnknownNamespaces="true"
                        cmhVersion="2">
                    <Forward name="failure" path="EXIT"/>
                    <Forward name="parserError" path="EXIT"/>
                </EsbSoapOutputValidator>

                <Forward name="success" path="EXIT" />
            </EsbJmsSender>


<!--            <SenderPipe-->
<!--                    name="SendBackRegisterResponse">-->
<!--                <IbisLocalSender-->
<!--                        name="RegisterSender"-->
<!--                        javaListener="RegisterResponse">-->
<!--                    <Param name="RegisterResponseValue" sessionKey="originalMessage"/>-->
<!--                </IbisLocalSender>-->
<!--                <Forward name="success" path="EXIT"/>-->
<!--                <Forward name="exception" path="EXCEPTION" />-->
<!--            </SenderPipe>-->

            <Exit name="EXIT" state="success"/>

        </Pipeline>
    </Adapter>
</Module>