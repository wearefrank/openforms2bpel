<Module>
    <Adapter name="Initiate"
             description="">

        <Receiver name="Initiate">
            <EsbJmsListener name="Initiate"
                            destinationName=""
                            lookupDestination="false"
                            messageProtocol="RR"/>
        </Receiver>

        <Pipeline>
            <SoapInputValidator
                    schemaLocation="xsd/Initiate.xsd"
                    soapBody="initiateRequestMessage"
                    soapVersion="auto"
                    ignoreUnknownNamespaces="true">
                <Forward name="failure" path="EXIT"/>
                <Forward name="parserError" path="EXIT"/>
            </SoapInputValidator>

            <SoapOutputValidator
                    schemaLocation="xsd/Initiate.xsd"
                    soapBody="initiateResponseMessage"
                    soapVersion="auto"
                    ignoreUnknownNamespaces="true">
                <Forward name="failure" path="EXIT"/>
                <Forward name="parserError" path="EXIT"/>
            </SoapOutputValidator>

<!--            Xslt -->

            <SenderPipe name="">
                <WebServiceSender name="SendInitiateProcess" url="${openforms2bpel.initiateEndpoint}">
                    <Param name="soapAction" value=""/>

                    <SoapInputWrapper direction="unwrap"
                                         removeOutputNamespaces="true"
                                         storeResultInSessionKey="originalMessage" />

                    <SoapOutputWrapper>
                        <param name="errorCode" sessionKey="errorCode"/>
                        <param name="errorReason" sessionKey="errorReason"/>
                    </SoapOutputWrapper>


                    <Forward name="success" path="SendBackInitiateResponse" />
                </WebServiceSender>
            </SenderPipe>

            <SenderPipe
                    name="SendBackInitiateResponse">
                <IbisLocalSender
                        name="InitiateSender"
                        javaListener="StartRegisterProcess">
                    <Param name="InitiateResponseValue" sessionKey="originalMessage" />
                </IbisLocalSender>
                <Forward name="success" path="EXIT"/>
                <Forward name="exception" path="EXCEPTION" />
            </SenderPipe>

            <Exit name="EXIT" state="success"/>

        </Pipeline>
    </Adapter>
</Module>