---
sidebar_position: 110
---

# Two Way Communication Workflow

This workflow facilitates the uploading of additional documents to an existing case. Only the initiating subject of the target case can upload documents for that case. 
Therefore, the workflow only accepts a uw-gegevens section containing an authenticated initiating subject.

If the provided target case is not recognized, or if the form's initiating subject is not the initiating subject of the provided target case, a configurable no-reply email is sent to the form's initiating subject.

**Triggered on:** Presence of a section named `gegevenstweewegcommunicatie`.

**Requirements:**
- **uw-gegevens** section
- `zaaknummer` property under **gegevenstweewegcommunicatie**.

### Workflow steps
1. Filter **uw-gegevens** section based on the used authentication method and subject entity(Person with DigiD, Organization with E-Herkenning). Aditionally ensure the initiating subject is authenticated.

1. Retrieve the provided target case given in the `zaaknummer` property under the **gegevenstweewegcommunicatie** section as **case reference**. The case is retrieved by first using the **case reference** 
   to obtain the **case id** with a `lookUpCaseIds` message to the [cases-service](.), followed by a `readCases` message to the [cases-service](.) using the **case id**. If the **case reference** is not known, 
   an e-mail is sent to the form's initiating subject using the configured **SMTP Server/Relay** and the **mail template** configured in the `openforms2bpel.workflows.onErrorActions.onCaseNotFound.templateName` property.
   A `CaseNotFound_Exception` is thrown instead if there is no **mail template** configured.

   :::note
   This workflow mentions two different **case references**. We are only concerned with the target **case reference** given in the **gegevenstweewegcommunicatie**. The `public_reference`(OF-Number) generated by OpenForms
   is only used as part of the idempotency key.
   :::

1. Check if the form's initiating subject is also the case's initiating subject. If this is not the case, an e-mail is sent to the form's initiating subject using the configured **SMTP Server/Relay** and the **mail template** 
   configured in the `openforms2bpel.workflows.onErrorActions.onSubjectNotEqualsCaseSubject.templateName` property. A `SubjectNotEqualsCaseSubject_Exception` is thrown instead if there is 
   no **mail template** configured.

1. Check if the case is closed already. If this is the case, an e-mail is sent to the form's initiating subject using the configured **SMTP Server/Relay** and the **mail template** configured in 
   the `openforms2bpel.workflows.onErrorActions.onCaseClosed.templateName` property.A `CaseClosed_Exception` is thrown instead if there is no **mail template** configured.

   :::warning
      This check must always come after validating that the form's initiating subject is also the case's initiating subject. Otherwise the noreply e-mail notification could potentially be misused to leak information 
      about case closure status of cases that are not their own.
   :::

1. Upload all attachments provided in the form and the form result pdf to the **Document vault**, add them to the case and signal that the documents are ready to be processed from the **Document vault**.
   This is done by calling [AddDocumentsToCaseCommand](.).

   :::note
   In addition to the attachments provided in the form, the form's result pdf is also attached to the target case for administrative purposes.
   :::